module frinx-acl-extension {

  yang-version "1";

  // namespace
  namespace "http://frinx.openconfig.net/yang/acl/ext";

  prefix "oc-acl-ext";

  // import some basic types
  import frinx-openconfig-acl { prefix "oc-acl"; }
  // uniconfig imports
  import network-topology { prefix nt; revision-date "2013-10-21"; }
  import frinx-uniconfig-topology { prefix ut; revision-date "2017-11-21"; }

  // meta
  organization "Frinx s.r.o";

  contact
    "support@frinx.io";

  description
    "Extension to Acces Control List (ACL) implementation
    based on OpenConfig";

  revision "2018-03-14" {
    description
      "Initial release";
  }

  typedef hop-range {
    type string {
    // 0-255..0-255
    pattern '(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)' +
        '\.\.' +
        '(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)';
    }
    description
      "Hop count represented in inclusive range as
      <lower>..<higher>";
  }

  typedef icmp-msg-type {
    type union {
      type uint8 {
        range 0..255;
      }
      type enumeration {
        enum ANY {
          description
            "Indicates not specified message type";
        }
      }
    }
    description "ICMP message type";
  }

  grouping acl-hop-range {
    leaf hop-range {
      type hop-range;
      description
        "The IP packet's hop range (TTL)";
    }
  }

  grouping acl-icmp-type {
    container icmp {
      container config {
        leaf msg-type {
          type icmp-msg-type;
          description
            "ICMP message type";
        }
      }
    }
  }

  augment "/oc-acl:acl/oc-acl:acl-sets/oc-acl:acl-set/oc-acl:acl-entries/oc-acl:acl-entry/oc-acl:ipv4/oc-acl:config" {
    uses acl-hop-range;
  }

  augment "/oc-acl:acl/oc-acl:acl-sets/oc-acl:acl-set/oc-acl:acl-entries/oc-acl:acl-entry/oc-acl:ipv6/oc-acl:config" {
    uses acl-hop-range;
  }

  augment "/oc-acl:acl/oc-acl:acl-sets/oc-acl:acl-set/oc-acl:acl-entries/oc-acl:acl-entry" {
    uses acl-icmp-type;
  }

  augment "/nt:network-topology/nt:topology/nt:node/ut:configuration/oc-acl:acl/oc-acl:acl-sets/oc-acl:acl-set/oc-acl:acl-entries/oc-acl:acl-entry/oc-acl:ipv4/oc-acl:config" {
    uses oc-acl-ext:acl-hop-range;
  }

  augment "/nt:network-topology/nt:topology/nt:node/ut:configuration/oc-acl:acl/oc-acl:acl-sets/oc-acl:acl-set/oc-acl:acl-entries/oc-acl:acl-entry/oc-acl:ipv6/oc-acl:config" {
    uses oc-acl-ext:acl-hop-range;
  }

  augment "/nt:network-topology/nt:topology/nt:node/ut:configuration/oc-acl:acl/oc-acl:acl-sets/oc-acl:acl-set/oc-acl:acl-entries/oc-acl:acl-entry" {
    uses oc-acl-ext:acl-icmp-type;
  }
}
